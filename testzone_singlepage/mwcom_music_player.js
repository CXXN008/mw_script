(function () {var b=function(){var exports=this,module={exports:this};function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function _createClass(i,t,a){return t&&_defineProperties(i.prototype,t),a&&_defineProperties(i,a),i}console.log("music player loaded ...");var com=document.querySelector("#mwcom-music-player"),a_src=com.querySelector("a").href;com.style.display="inline";var params={};com.innerText.search("mwcom-config:")>0&&(params=eval(com.innerText.replace(/.+mwcom-config:/g,"")),console.log(params));var DEFAULTS={borderColor:"#8ebbc4",playedColor:"#ffffff",backgroundColor:"rgba(142,187,196,.3)",iconColor:"#ffffff",borderWidth:2,size:48,className:"circle-audio-player"},pi=Math.PI,doublePi=2*pi,arcOffset=-pi/2,animTime=200,loaderTime=1800,CircleAudioPlayer=function(){function i(t){for(var a in _classCallCheck(this,i),t=t||{},DEFAULTS)this[a]=t[a]||DEFAULTS[a];this._canvas=document.createElement("canvas"),this._canvas.setAttribute("class",this.className+" is-loading"),this._canvas.addEventListener("mousedown",function(){this.playing?this.pause():this.play()}.bind(this)),this._ctx=this._canvas.getContext("2d"),this.setAudio(t.audio),this.setSize(this.size),function i(t){this.animating&&this._updateAnimations(t),(this._forceDraw||this.playing||this.animating||this.loading)&&(this._draw(),this._forceDraw=!1),requestAnimationFrame(i.bind(this))}.call(this,new Date().getTime())}return _createClass(i,[{key:"_animateIcon",value:function(i,t){this._animationProps={animStart:null,from:t,to:i},t?this.animating=!0:(this._animationProps.current=this._icons[i].slice(),this.draw())}},{key:"_updateAnimations",value:function(i){this._animationProps.animStart=this._animationProps.animStart||i;var t=i-this._animationProps.animStart,a=1-Math.cos(t/animTime*pi/2);if(t>=animTime)this.animating=!1,a=1,this._animationProps.current=this._icons[this._animationProps.to].slice(),this.draw();else{for(var s=this._icons[this._animationProps.from],e=[],n=0;n<s.length;n++){e.push([]);for(var h=0;h<s[n].length;h++){e[n].push([]);var o=this._icons[this._animationProps.to][n][h];e[n][h][0]=s[n][h][0]+(o[0]-s[n][h][0])*a,e[n][h][1]=s[n][h][1]+(o[1]-s[n][h][1])*a}}this._animationProps.current=e}}},{key:"_draw",value:function(i){if(isNaN(i)&&(i=this.audio.currentTime/this.audio.duration||0),this._ctx.clearRect(0,0,this.size,this.size),this._ctx.beginPath(),this._ctx.arc(this._halfSize,this._halfSize,this._halfSize-this.borderWidth/2,0,doublePi),this._ctx.closePath(),this._ctx.fillStyle=this.backgroundColor,this._ctx.fill(),this._ctx.lineWidth=this.borderWidth,this._ctx.strokeStyle=this.borderColor,this._ctx.stroke(),i>0&&(this._ctx.beginPath(),this._ctx.arc(this._halfSize,this._halfSize,this._halfSize-this.borderWidth/2,arcOffset,arcOffset+doublePi*i),this._ctx.strokeStyle=this.playedColor,this._ctx.stroke()),this._ctx.fillStyle=this.iconColor,this.loading){var t=-Math.cos(new Date().getTime()%loaderTime/loaderTime*pi)*doublePi-pi/3-pi/2;this._ctx.beginPath(),this._ctx.arc(this._halfSize,this._halfSize,this._halfSize/3,t,t+pi/3*2),this._ctx.strokeStyle=this.iconColor,this._ctx.stroke()}else{this._ctx.beginPath();for(var a=this._animationProps&&this._animationProps.current||this._icons.play,s=0;s<a.length;s++){this._ctx.moveTo(a[s][0][0],a[s][0][1]);for(var e=1;e<a[s].length;e++)this._ctx.lineTo(a[s][e][0],a[s][e][1])}this._ctx.fill(),this._ctx.strokeStyle=this.iconColor,this._ctx.lineWidth=2,this._ctx.lineJoin="miter",this._ctx.stroke()}}},{key:"_setState",value:function(i){this.playing=!1,this.loading=!1,"playing"===i?(this.playing=!0,this._animateIcon("pause","play")):"loading"===i?this.loading=!0:"loading"!==this.state?this._animateIcon("play","pause"):this._animateIcon("play",null),this.state=i,this._canvas.setAttribute("class",this.className+" is-"+i),this.draw()}},{key:"draw",value:function(){this._forceDraw=!0}},{key:"setSize",value:function(i){this.size=i,this._halfSize=i/2,this._canvas.width=i,this._canvas.height=i;var t=this.size/2,a=t/10,s=Math.cos(pi/3*2)*(t/2)+this._halfSize,e=t/2+this._halfSize,n=(e-s)/2+s,h=this._halfSize-Math.sin(pi/3*2)*(t/2),o=this.size-h,r=this._halfSize-t/3,l=this.size-r;this._icons={play:[[[s,h],[n,(this._halfSize-h)/2+h],[n,(this._halfSize-h)/2+this._halfSize],[s,o]],[[n,(this._halfSize-h)/2+h],[e,this._halfSize],[e,this._halfSize],[n,(this._halfSize-h)/2+this._halfSize]]],pause:[[[r,h+a],[this._halfSize-a,h+a],[this._halfSize-a,o-a],[r,o-a]],[[this._halfSize+a,h+a],[l,h+a],[l,o-a],[this._halfSize+a,o-a]]]},this._animationProps&&this._animationProps.current&&this._animateIcon(this._animationProps.to),this.playing||this.draw()}},{key:"setAudio",value:function(i){this.audio=new Audio(i),this._setState("loading"),this.audio.addEventListener("canplaythrough",function(){this._setState("paused")}.bind(this)),this.audio.addEventListener("play",function(){this._setState("playing")}.bind(this)),this.audio.addEventListener("pause",function(){this.audio.currentTime===this.audio.duration&&(this.audio.currentTime=0),this._setState("paused")}.bind(this))}},{key:"appendTo",value:function(i){i.appendChild(this._canvas)}},{key:"play",value:function(){this.audio.play()}},{key:"pause",value:function(){this.audio.pause()}}]),i}();params.audio=a_src;var cap=new CircleAudioPlayer(params);return com.innerHTML="",cap.appendTo(com),module.exports}.call({});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b}else if(typeof define==="function"&&define.amd){define(function(){return b})}})();